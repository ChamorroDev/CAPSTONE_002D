{% extends 'base.html' %}
{% load static %}

{% block title %} Dashboard - Junta de Vecinos{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/vecinos/vecino_dashboard.css' %}">

<div class="container-fluid px-4 py-4">
    <div id="dashboard-content">
        <!-- Loading State -->
        <div class="text-center py-5" id="loading-spinner">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-3 text-muted">Cargando su dashboard...</p>
        </div>
        
        <!-- Error State -->
        <div id="auth-error" class="alert alert-danger d-none">
            <div class="text-center">
                <i class="bi bi-shield-exclamation" style="font-size: 3rem;"></i>
                <h4 class="mt-3">Error de acceso</h4>
                <p id="error-message">No se pudieron cargar los datos del dashboard</p>
                <div class="mt-3">
                    <a href="{% url 'index' %}" class="btn btn-primary me-2">
                        <i class="bi bi-house"></i> Volver al inicio
                    </a>
                    <button onclick="window.location.reload()" class="btn btn-outline-primary">
                        <i class="bi bi-arrow-clockwise"></i> Reintentar
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Success State -->
        <div id="dashboard-data" class="d-none fade-in">
            <!-- Header con gradiente -->
            <div class="dashboard-header mb-5">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <div class="welcome-section">
                            <h1 id="welcome-message" class="welcome-title">
                                <span class="greeting">¡Hola,</span> 
                                <span id="user-name" class="user-name">Vecino</span>!
                            </h1>
                            <p class="welcome-subtitle" id="junta-nombre">
                                <i class="bi bi-geo-alt-fill"></i> Junta de Vecinos - Comunidad Activa
                            </p>
                        </div>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <div class="status-badge">
                            <i class="bi bi-patch-check-fill"></i>
                            <span>Miembro Verificado</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <!-- Columna izquierda: Información personal y acciones -->
                <div class="col-lg-4">
                    <!-- Tarjeta de información personal -->
                    <div class="dashboard-card profile-card mb-4">
                        <a href="{% url 'mi_perfil' %}" style="text-decoration: none;">
                        <div class="card-header-gradient">
                            <div class="d-flex align-items-center">
                                <div class="avatar-circle me-3">
                                    <i class="bi bi-person-fill"></i>
                                </div>
                                <div>
                                    <h5 class="card-title mb-0">Mi Perfil</h5>
                                    <small class="text-white-50">Información personal</small>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="user-info" class="user-info-list">
                                <div class="info-item">
                                    <i class="bi bi-person-badge"></i>
                                    <div>
                                        <span class="info-label">Nombre completo</span>
                                        <span id="info-nombre" class="info-value">Cargando...</span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="bi bi-envelope"></i>
                                    <div>
                                        <span class="info-label">Correo electrónico</span>
                                        <span id="info-email" class="info-value">Cargando...</span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="bi bi-telephone"></i>
                                    <div>
                                        <span class="info-label">Teléfono</span>
                                        <span id="info-telefono" class="info-value">Cargando...</span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="bi bi-house-door"></i>
                                    <div>
                                        <span class="info-label">Dirección</span>
                                        <span id="info-direccion" class="info-value">Cargando...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </a>
                    </div>


                    <!-- Acciones rápidas -->
                    <div class="dashboard-card quick-actions-card">
                        <div class="card-header-light">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-lightning-charge"></i> Acciones 
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="quick-actions-grid">
                                <a href="{% url 'solicitud_certificado' %}" class="quick-action-item">
                                    <div class="action-icon certificado">
                                        <i class="bi bi-file-text"></i>
                                    </div>
                                    <span class="action-text">Certificado de Residencia</span>
                                    <i class="bi bi-arrow-right-short action-arrow"></i>
                                </a>
                                
                                <a href="{% url 'solicitud_espacios' %}" class="quick-action-item">
                                    <div class="action-icon espacios">
                                        <i class="bi bi-geo-alt"></i>
                                    </div>
                                    <span class="action-text">Solicitud de Espacios</span>
                                    <i class="bi bi-arrow-right-short action-arrow"></i>
                                </a>
                                
                                <a href="{% url 'solicitud_proyecto' %}" class="quick-action-item">
                                    <div class="action-icon proyecto">
                                        <i class="bi bi-lightbulb"></i>
                                    </div>
                                    <span class="action-text">Propuesta de Proyecto</span>
                                    <i class="bi bi-arrow-right-short action-arrow"></i>
                                </a>
                                
                                <a href="{% url 'eventos' %}" class="quick-action-item">
                                    <div class="action-icon eventos">
                                        <i class="bi bi-calendar-event"></i>
                                    </div>
                                    <span class="action-text">Ver Eventos</span>
                                    <i class="bi bi-arrow-right-short action-arrow"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Columna derecha: Contenido principal -->
                <div class="col-lg-8">
                    <!-- Estadísticas de solicitudes SIMPLIFICADA -->
                    <div class="dashboard-card stats-card mb-4">
                        <div class="card-header-light">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-bar-chart-line"></i> Mis Solicitudes
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="stats-simple">
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="stat-main total">
                                            <div class="stat-number" id="stats-totales">0</div>
                                            <div class="stat-label">Total Solicitudes</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stat-main pending">
                                            <div class="stat-number" id="stats-pendientes">0</div>
                                            <div class="stat-label">Pendientes</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stat-main approved">
                                            <div class="stat-number" id="stats-aprobadas">0</div>
                                            <div class="stat-label">Aprobadas</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Noticias recientes -->
                    <div class="dashboard-card news-card mb-4">
                        <div class="card-header-light d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-newspaper"></i> Últimas Noticias
                            </h5>
                            <a href="{% url 'noticias' %}" class="btn-view-all">
                                Ver todas <i class="bi bi-arrow-right"></i>
                            </a>
                        </div>
                        <div class="card-body">
                            <div id="noticias-container">
                                <div class="content-container">
                                    <div class="loading-content">
                                        <div class="spinner-border spinner-border-sm" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                        <p class="text-muted mt-2">Cargando noticias...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Próximas actividades -->
                    <div class="dashboard-card activities-card">
                        <div class="card-header-light d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-calendar-event"></i> Próximas Actividades
                            </h5>
                            <a href="{% url 'eventos' %}" class="btn-view-all">
                                Ver todas <i class="bi bi-arrow-right"></i>
                            </a>
                        </div>
                        <div class="card-body">
                            <div id="actividades-container">
                                <div class="content-container">
                                    <div class="loading-content">
                                        <div class="spinner-border spinner-border-sm" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                        <p class="text-muted mt-2">Cargando actividades...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/vecino/vecino-dashboard.js' %}"></script>
{% endblock %}